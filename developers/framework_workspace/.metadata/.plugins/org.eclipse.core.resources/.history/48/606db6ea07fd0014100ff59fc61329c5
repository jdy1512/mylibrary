package spring.mvc.upload;

import java.io.File;
import java.io.IOException;

import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.MultipartFile;

@Controller
@RequestMapping("/upload/")
public class FileuploadController {
	private String imageDir = "C:\\Users\\KOSTA_03_001_\\Desktop\\mylibrary\\developers\\framework_workspace\\spring_mvc_05_fileUpload";

	@RequestMapping("singleup")
	// input type=file 요청파라미터를 받은 변수
	// 1. MultipartFile 타입으로 선언.
	// 2. @RequestParam("요청파라미터명")을 붙여야 한다.
	public String singleUpload( @RequestParam String title,
								@RequestParam("upfile") MultipartFile upfile,
								@RequestParam String info,
								ModelMap map) throws IllegalStateException, IOException {
		System.out.println(title + " , " + info);
		// 업로드된 파일은 임시저장소에 있다.
		// controller메소드 - 파일을 원하는 경로로 이동, 파일 정보를 조회
		
		if (upfile != null && !upfile.isEmpty()) { // 업로드 된 파일이 있다면
			String fileName = upfile.getOriginalFilename(); // 업로드된 파일명
			long size = upfile.getSize(); // 업로드된 파일의 크기(byte)
			// 파일을 원하는 경로로 이동
			File file = new File(imageDir, fileName);
			upfile.transferTo(file);
			// 업로드 정보를 View로 전달
			map.addAttribute("filename", fileName);
			map.addAttribute("filesize", size);
			map.addAttribute("title", title);
			map.addAttribute("info", info);
		} else {
			map.addAttribute("title", "업로드된 파일이 없습니다");
		}
		return "";
	}// end of singleUpload
}
